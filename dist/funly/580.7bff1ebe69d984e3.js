"use strict";(self.webpackChunksidenav=self.webpackChunksidenav||[]).push([[580],{11209:(ee,y,l)=>{l.d(y,{_:()=>x});var p=l(36895),e=l(41571);class x{static#e=this.\u0275fac=function(S){return new(S||x)};static#t=this.\u0275mod=e.oAB({type:x});static#n=this.\u0275inj=e.cJS({imports:[p.ez]})}},14580:(ee,y,l)=>{l.r(y),l.d(y,{ChatsModule:()=>H});var p=l(36895),e=l(41571),x=l(5830),B=l(4471),U=l(7053),S=l(55418),C=l(67182);function X(i,n,t,o,a,s,r){try{var c=i[s](r),g=c.value}catch(h){return void t(h)}c.done?n(g):Promise.resolve(g).then(o,a)}function A(i){return function(){var n=this,t=arguments;return new Promise(function(o,a){var s=i.apply(n,t);function r(g){X(s,o,a,r,c,"next",g)}function c(g){X(s,o,a,r,c,"throw",g)}r(void 0)})}}var te=l(54968),J=l(11481);class O{constructor(n){this.sanitizer=n}ngOnInit(){return A(function*(){})()}startRecording(){return new Promise(function(){var n=A(function*(t){navigator.mediaDevices.getUserMedia({audio:!0}).then(o=>{const a=new MediaRecorder(o),s=[];a.addEventListener("dataavailable",g=>{s.push(g.data)}),t({start:()=>a.start(),stop:()=>new Promise(g=>{a.addEventListener("stop",()=>{const h=new Blob(s),m=URL.createObjectURL(h),u=new Audio(m);g({audioBlob:h,audioUrl:m,play:()=>u.play()})}),a.stop()})})})});return function(t){return n.apply(this,arguments)}}())}static#e=this.\u0275fac=function(t){return new(t||O)(e.LFG(J.H7))};static#t=this.\u0275prov=e.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"})}var d=l(24006);function ne(i,n){if(1&i&&(e.TgZ(0,"p",6),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.unread_messages.length," mensajes sin leer")}}function oe(i,n){1&i&&e._UZ(0,"span",12)}function ie(i,n){if(1&i&&(e.TgZ(0,"div",9),e._UZ(1,"img",10),e.YNc(2,oe,1,0,"span",11),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("src",null==t||null==t.user?null:t.user.avatar,e.LSH),e.xp6(1),e.Q6J("ngIf",null==t||null==t.user?null:t.user.online)}}function ae(i,n){if(1&i&&(e.TgZ(0,"div",7),e.YNc(1,ie,3,2,"div",8),e.qZA()),2&i){const t=e.oxw(),o=t.$implicit,a=t.index,s=e.oxw();e.MGl("routerLink","/",null==o||null==o.user?null:o.user.id,"/profile"),e.xp6(1),e.Q6J("ngIf",(null==s.messages[a-1]||null==s.messages[a-1].user?null:s.messages[a-1].user.id)!=(null==o.user?null:o.user.id))}}function se(i,n){if(1&i&&(e.TgZ(0,"p",20),e._uU(1),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.user?null:t.user.name," ")}}function re(i,n){if(1&i&&e._UZ(0,"img",21),2&i){const t=e.oxw(3).$implicit;e.Q6J("src",t.image,e.LSH)}}function ce(i,n){if(1&i&&(e.TgZ(0,"span",22),e._uU(1),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.hij("",null==t?null:t.text," ")}}function ge(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"a",23),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3).$implicit,s=e.oxw();return e.KtG(s.openLink(null==a?null:a.text))}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.hij("",null==t?null:t.text," ")}}function pe(i,n){if(1&i&&(e.TgZ(0,"span",24),e._UZ(1,"i"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Tol(t.pending?"fa-regular fa-clock":"fa-solid fa-check")}}function le(i,n){if(1&i&&(e.TgZ(0,"div",4),e.YNc(1,se,2,1,"p",14),e.YNc(2,re,1,1,"img",15),e.YNc(3,ce,2,1,"span",16),e.YNc(4,ge,2,1,"a",17),e.YNc(5,pe,2,3,"span",18),e.TgZ(6,"span",19),e._uU(7),e.ALo(8,"date"),e.qZA()()),2&i){const t=e.oxw(2).$implicit,o=e.oxw();e.Q6J("ngClass",(null==o.user?null:o.user.id)==(null==t||null==t.user?null:t.user.id)?"message message-right":"message message-left"),e.xp6(1),e.Q6J("ngIf",(null==o.user?null:o.user.id)!=(null==t||null==t.user?null:t.user.id)),e.xp6(1),e.Q6J("ngIf",t.image),e.xp6(1),e.Q6J("ngIf",!o.isLink(null==t?null:t.text)),e.xp6(1),e.Q6J("ngIf",o.isLink(null==t?null:t.text)),e.xp6(1),e.Q6J("ngIf",(null==o.user?null:o.user.id)==(null==t||null==t.user?null:t.user.id)),e.xp6(2),e.hij(" ",e.xi3(8,7,null==t?null:t.created_at,"HH:mm"),"")}}function he(i,n){1&i&&e._UZ(0,"i",33)}function de(i,n){1&i&&e._UZ(0,"i",34)}function me(i,n){if(1&i&&(e.TgZ(0,"span",35),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,1e3*t.audio.duration,"m:ss"))}}function ue(i,n){if(1&i&&(e.TgZ(0,"span",35),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,1e3*t.audio.duration,"m:ss"))}}function _e(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",25),e._UZ(2,"img",21),e.qZA(),e.TgZ(3,"div",26),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2).$implicit,s=e.oxw();return e.KtG(s.togglePlay(a))}),e.YNc(4,he,1,0,"i",27),e.YNc(5,de,1,0,"i",28),e.qZA(),e.TgZ(6,"div",29),e._UZ(7,"input",30),e.qZA(),e.YNc(8,me,3,4,"span",31),e.YNc(9,ue,3,4,"span",31),e.TgZ(10,"span",32),e._uU(11),e.ALo(12,"date"),e.qZA()()}if(2&i){const t=e.oxw(2).$implicit,o=e.oxw();e.Q6J("ngClass",(null==o.user?null:o.user.id)==(null==t||null==t.user?null:t.user.id)?"chat-audio message-right":"chat-audio message-left"),e.xp6(1),e.MGl("routerLink","/",null==t||null==t.user?null:t.user.id,"/profile"),e.xp6(1),e.Q6J("src",null==o.user?null:o.user.avatar,e.LSH),e.xp6(2),e.Q6J("ngIf",!t.is_playing_audio),e.xp6(1),e.Q6J("ngIf",t.is_playing_audio),e.xp6(2),e.Q6J("max",t.audio.duration)("min",0)("value",t.audio.currentTime),e.xp6(1),e.Q6J("ngIf",0==t.audio.currentTime),e.xp6(1),e.Q6J("ngIf",t.audio.currentTime>0),e.xp6(2),e.hij(" ",e.xi3(12,11,null==t?null:t.created_at,"HH:mm"),"")}}function fe(i,n){if(1&i&&(e.ynx(0),e.YNc(1,le,9,10,"div",13),e.YNc(2,_e,13,14,"div",13),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",!t.audio),e.xp6(1),e.Q6J("ngIf",t.audio)}}function xe(i,n){if(1&i&&e._UZ(0,"img",21),2&i){const t=e.oxw(3).$implicit;e.Q6J("src",t.image,e.LSH)}}function Ce(i,n){if(1&i&&(e.TgZ(0,"span",22),e._uU(1),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.hij("",null==t?null:t.text," ")}}function ve(i,n){if(1&i&&(e.TgZ(0,"span",24),e._UZ(1,"i"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Tol(t.pending?"fa-regular fa-clock":"fa-solid fa-check")}}function Me(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"a",23),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3).$implicit,s=e.oxw();return e.KtG(s.openLink(null==a?null:a.text))}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.hij("",null==t?null:t.text," ")}}function Pe(i,n){if(1&i&&(e.TgZ(0,"div",4),e.YNc(1,xe,1,1,"img",15),e.YNc(2,Ce,2,1,"span",16),e.YNc(3,ve,2,3,"span",18),e.YNc(4,Me,2,1,"a",17),e.TgZ(5,"span",19),e._uU(6),e.ALo(7,"date"),e.qZA()()),2&i){const t=e.oxw(2).$implicit,o=e.oxw();e.Q6J("ngClass",(null==o.user?null:o.user.id)==(null==t||null==t.user?null:t.user.id)?"message-right-simple message":"message-simple message"),e.xp6(1),e.Q6J("ngIf",t.image),e.xp6(1),e.Q6J("ngIf",!o.isLink(null==t?null:t.text)),e.xp6(1),e.Q6J("ngIf",(null==o.user?null:o.user.id)==(null==t||null==t.user?null:t.user.id)),e.xp6(1),e.Q6J("ngIf",o.isLink(null==t?null:t.text)),e.xp6(2),e.hij(" ",e.xi3(7,6,null==t?null:t.created_at,"HH:mm"),"")}}function we(i,n){1&i&&e._UZ(0,"i",33)}function Oe(i,n){1&i&&e._UZ(0,"i",34)}function be(i,n){if(1&i&&(e.TgZ(0,"span",35),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,1e3*t.audio.duration,"m:ss"))}}function Ie(i,n){if(1&i&&(e.TgZ(0,"span",35),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,1e3*t.audio.currentTime,"m:ss"))}}function ye(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",25),e._UZ(2,"img",21),e.qZA(),e.TgZ(3,"div",26),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2).$implicit,s=e.oxw();return e.KtG(s.togglePlay(a))}),e.YNc(4,we,1,0,"i",27),e.YNc(5,Oe,1,0,"i",28),e.qZA(),e.TgZ(6,"div",29)(7,"input",36),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw(2).$implicit;return e.KtG(s.audio.currentTime=a)}),e.qZA()(),e.YNc(8,be,3,4,"span",31),e.YNc(9,Ie,3,4,"span",31),e.TgZ(10,"span",32),e._uU(11),e.ALo(12,"date"),e.qZA()()}if(2&i){const t=e.oxw(2).$implicit,o=e.oxw();e.Q6J("ngClass",(null==o.user?null:o.user.id)==(null==t||null==t.user?null:t.user.id)?"chat-audio message-right-simple":"chat-audio message-simple"),e.xp6(1),e.MGl("routerLink","/",null==t||null==t.user?null:t.user.id,"/profile"),e.xp6(1),e.Q6J("src",null==o.user?null:o.user.avatar,e.LSH),e.xp6(2),e.Q6J("ngIf",!t.is_playing_audio),e.xp6(1),e.Q6J("ngIf",t.is_playing_audio),e.xp6(2),e.Q6J("max",t.audio.duration)("min",0)("ngModel",t.audio.currentTime),e.xp6(1),e.Q6J("ngIf",0==t.audio.currentTime),e.xp6(1),e.Q6J("ngIf",t.audio.currentTime>0),e.xp6(2),e.hij(" ",e.xi3(12,11,null==t?null:t.created_at,"HH:mm"),"")}}function Se(i,n){if(1&i&&(e.ynx(0),e.YNc(1,Pe,8,9,"div",13),e.YNc(2,ye,13,14,"div",13),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",!t.audio),e.xp6(1),e.Q6J("ngIf",t.audio)}}function Ae(i,n){if(1&i&&(e.TgZ(0,"div",1),e.YNc(1,ne,2,1,"p",2),e.YNc(2,ae,2,2,"div",3),e.TgZ(3,"div",4),e.YNc(4,fe,3,2,"ng-container",5),e.YNc(5,Se,3,2,"ng-container",5),e.qZA()()),2&i){const t=n.$implicit,o=n.index,a=e.oxw();e.xp6(1),e.Q6J("ngIf",a.unread_messages.length>0&&0==(null==a.messages[o-1]?null:a.messages[o-1].unread)&&1==(null==a.messages[o]?null:a.messages[o].unread)),e.xp6(1),e.Q6J("ngIf",(null==a.user?null:a.user.id)!=(null==t||null==t.user?null:t.user.id)),e.xp6(1),e.Q6J("ngClass",(null==a.user?null:a.user.id)!=(null==t||null==t.user?null:t.user.id)?"col-lg-11 col-10":"col-lg-11 col-11"),e.xp6(1),e.Q6J("ngIf",(null==a.messages[o-1]||null==a.messages[o-1].user?null:a.messages[o-1].user.id)!=(null==t||null==t.user?null:t.user.id)),e.xp6(1),e.Q6J("ngIf",(null==a.messages[o-1]||null==a.messages[o-1].user?null:a.messages[o-1].user.id)==(null==t||null==t.user?null:t.user.id))}}class T{constructor(){this.unread_messages=[],this.currentTime=0}togglePlay(n){n.is_playing_audio?n.audio.pause():n.audio.play(),console.log("DURACION",n.audio?.duration),n.audio.ontimeupdate=t=>{this.currentTime=n.audio.currentTime},n.audio.onplaying=()=>{n.is_playing_audio=!0},n.audio.onpause=()=>{n.is_playing_audio=!1},n.audio.addEventListener("ended",function(){n.audio.currentTime=0,this.currentTime=0,console.log("ended")}),n.audio.addEventListener("loadeddata",function(){console.log("Audio duration: "+this.duration)})}isLink(n){if(!n)return!1;try{return new URL(n),!0}catch{return!1}}openLink(n){window.open(n,"_blank")}static#e=this.\u0275fac=function(t){return new(t||T)};static#t=this.\u0275cmp=e.Xpm({type:T,selectors:[["app-message-item"]],inputs:{messages:"messages",user:"user",unread_messages:"unread_messages"},decls:1,vars:1,consts:[["class","message-container justify-content-center row",4,"ngFor","ngForOf"],[1,"message-container","justify-content-center","row"],["class","unread-messages",4,"ngIf"],["class","col-lg-1 col-2 user-image",3,"routerLink",4,"ngIf"],[3,"ngClass"],[4,"ngIf"],[1,"unread-messages"],[1,"col-lg-1","col-2","user-image",3,"routerLink"],["class","avatar-content",4,"ngIf"],[1,"avatar-content"],["alt","","onError","this.src='assets/imgs/avatar.png'",3,"src"],["class","user-online",4,"ngIf"],[1,"user-online"],[3,"ngClass",4,"ngIf"],["class","message-username",4,"ngIf"],["alt","",3,"src",4,"ngIf"],["class","message-text",4,"ngIf"],["href","javascript:void(0)","class","message-text",3,"click",4,"ngIf"],["class","message-read",4,"ngIf"],[1,"message-hour"],[1,"message-username"],["alt","",3,"src"],[1,"message-text"],["href","javascript:void(0)",1,"message-text",3,"click"],[1,"message-read"],[1,"col-3","user-audio-avatar","my-auto",3,"routerLink"],[1,"col-3","play-button","my-auto",3,"click"],["class","fa fa-play",4,"ngIf"],["class","fa fa-pause",4,"ngIf"],[1,"col","time-range","my-auto"],["type","range","step","0.1",3,"max","min","value"],["class","audio-duration",4,"ngIf"],[1,"audio-hour"],[1,"fa","fa-play"],[1,"fa","fa-pause"],[1,"audio-duration"],["type","range","step","0.1",3,"max","min","ngModel","ngModelChange"]],template:function(t,o){1&t&&e.YNc(0,Ae,6,5,"div",0),2&t&&e.Q6J("ngForOf",o.messages)},dependencies:[p.mk,p.sg,p.O5,d.Fj,d.eT,d.JJ,d.On,C.rH,p.uU],styles:['.message-container[_ngcontent-%COMP%]{position:relative;margin-bottom:0}.message-container[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{text-align:center;padding:10px;margin-right:20px;background:rgba(0,0,0,.2);margin-top:10px;font-weight:700}.message-container[_ngcontent-%COMP%]   .user-image[_ngcontent-%COMP%]{cursor:pointer;padding:0;text-align:center}.message-container[_ngcontent-%COMP%]   .user-image[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]{position:relative;overflow:hidden;display:inline;margin:0 auto}.message-container[_ngcontent-%COMP%]   .user-image[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:5px solid white;box-shadow:var(--item-box-shadow);border-radius:50%;height:60px;width:60px;object-fit:cover}.message-container[_ngcontent-%COMP%]   .user-image[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]   .user-online[_ngcontent-%COMP%]{position:absolute;top:15px;right:-2px;background:var(--color-open-reservation);height:20px;width:20px;border:4px solid white;border-radius:50px;z-index:9}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{padding:10px 10px 5px;border-radius:15px;box-shadow:var(--item-box-shadow);background:var(--color-primary-light);color:#fff;position:relative;margin-top:15px;max-width:80%;display:inline-block}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px;margin-bottom:3px;width:100%;max-width:350px;display:block}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-username[_ngcontent-%COMP%]{margin:-4px 0 0;font-size:14px;font-weight:700;color:var(--chat-message-right-background)}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-user[_ngcontent-%COMP%]{font-weight:700;margin:0}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{font-size:16px;color:#fff;overflow-wrap:break-word}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-hour[_ngcontent-%COMP%]{opacity:.5;float:right;margin:5px 0 0 10px;font-size:12px}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]{opacity:.8;float:right;margin:5px 0 0 -10px;font-size:14px}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]{background:var(--chat-message-right-background);width:5px;height:5px}.message-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-read[_ngcontent-%COMP%]{opacity:.8;float:right;margin:5px 0 0 5px;font-size:14px}.message-container[_ngcontent-%COMP%]   .message-simple[_ngcontent-%COMP%]{margin-top:4px;float:left;border-radius:8px 15px 15px 8px;background:var(--chat-message-left-background)}.message-container[_ngcontent-%COMP%]   .message-right-simple[_ngcontent-%COMP%]{margin-top:4px;float:right;border-radius:15px 8px 8px 15px;background:var(--chat-message-right-background)}.message-container[_ngcontent-%COMP%]   .message-right[_ngcontent-%COMP%]:before{content:"";width:0px;height:0px;position:absolute;border-left:10px solid var(--chat-message-right-background);border-right:10px solid transparent;border-top:10px solid var(--chat-message-right-background);border-bottom:10px solid transparent;right:-10px;top:0}.message-container[_ngcontent-%COMP%]   .message-left[_ngcontent-%COMP%]:before{content:"";width:0px;height:0px;position:absolute;border-left:10px solid transparent;border-right:10px solid var(--chat-message-left-background);border-top:10px solid var(--chat-message-left-background);border-bottom:10px solid transparent;left:-10px;top:0}.message-container[_ngcontent-%COMP%]   .message-left[_ngcontent-%COMP%]{float:left;border-radius:5px 15px 15px 8px;background:var(--chat-message-left-background)}.message-container[_ngcontent-%COMP%]   .message-right[_ngcontent-%COMP%]{float:right;border-radius:15px 8px 15px 15px;background:var(--chat-message-right-background)}@media (max-width: 902px){.messages-container[_ngcontent-%COMP%]{padding:20px 5px 50px 25px!important}.messages-container[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]   .user-online[_ngcontent-%COMP%]{height:15px!important;width:15px!important;border:2px solid white!important}.messages-container[_ngcontent-%COMP%]   .user-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:3px solid white!important;box-shadow:var(--item-box-shadow);border-radius:50%;height:55px!important;width:55px!important;object-fit:cover}.messages-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{max-width:250px!important}}']})}function Te(i,n){if(1&i&&(e.TgZ(0,"p",13),e._uU(1),e.ALo(2,"date"),e.ALo(3,"slice"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.lnq("",t.selectedChat.name," - ",e.xi3(2,3,null==t.selectedChat.open_reservation?null:t.selectedChat.open_reservation.date,"dd/MMM")," - ",e.Dn7(3,6,null==t.selectedChat.open_reservation||null==t.selectedChat.open_reservation.game_reservation_hour?null:t.selectedChat.open_reservation.game_reservation_hour.hour,0,5)," ")}}function ze(i,n){if(1&i&&e._UZ(0,"img",20),2&i){const t=e.oxw().$implicit;e.Q6J("src",t.avatar,e.LSH)}}function Re(i,n){1&i&&e._UZ(0,"span",21)}function ke(i,n){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.hij("y ",(null==t.selectedChat.users?null:t.selectedChat.users.length)-6," m\xe1s")}}function Ee(i,n){if(1&i&&(e.ynx(0),e.TgZ(1,"div",16),e.YNc(2,ze,1,1,"img",17),e.YNc(3,Re,1,0,"span",18),e.qZA(),e.YNc(4,ke,2,1,"span",19),e.BQk()),2&i){const t=n.$implicit,o=n.index;e.xp6(2),e.Q6J("ngIf",o<6),e.xp6(1),e.Q6J("ngIf",t.online),e.xp6(1),e.Q6J("ngIf",6==o)}}function He(i,n){if(1&i&&(e.TgZ(0,"div",14),e.YNc(1,Ee,5,3,"ng-container",15),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==t.selectedChat?null:t.selectedChat.users)}}function Ye(i,n){if(1&i&&(e.TgZ(0,"span",25),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(null==t.selectedChat?null:t.selectedChat.unread_messages_count)}}function Ze(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.scrollToBottom())}),e._UZ(1,"i",23),e.YNc(2,Ye,2,1,"span",24),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",(null==t.selectedChat?null:t.selectedChat.unread_messages_count)>0)}}function Qe(i,n){1&i&&(e.TgZ(0,"div",26)(1,"div",27),e._UZ(2,"img",28),e.qZA()())}function Ue(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",39)(1,"i",40),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.deleteImage())}),e.qZA(),e._UZ(2,"img",41),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("src",null==t.actualMessage?null:t.actualMessage.image,e.LSH)}}function Le(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",42),e.NdJ("mousedown",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.recordAudio())})("mouseup",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.stopRecordingAudio())}),e._UZ(1,"i",43),e.qZA()}}function We(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",44),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.sendMessage())}),e._UZ(1,"i",45),e.qZA()}}function Be(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",29)(1,"div",30),e.YNc(2,Ue,3,1,"div",31),e.TgZ(3,"input",32),e.NdJ("keydown.enter",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.sendMessage())})("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.actualMessage.text=a)})("focus",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.readMessages())}),e.qZA(),e.TgZ(4,"div",33)(5,"label",34),e._UZ(6,"i",35),e.qZA(),e.TgZ(7,"input",36),e.NdJ("change",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.uploadImage(a))}),e.qZA()(),e.YNc(8,Le,2,0,"button",37),e.YNc(9,We,2,0,"button",38),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",null==t.actualMessage?null:t.actualMessage.image),e.xp6(1),e.Q6J("ngModel",t.actualMessage.text),e.xp6(5),e.Q6J("ngIf",""==(null==t.actualMessage?null:t.actualMessage.text)&&!(null!=t.actualMessage&&t.actualMessage.image)),e.xp6(1),e.Q6J("ngIf",""!=(null==t.actualMessage?null:t.actualMessage.text)||(null==t.actualMessage?null:t.actualMessage.image))}}class z{constructor(n,t,o,a,s,r,c){this.apiService=n,this.loading=t,this.auth=o,this.chatAudio=a,this.sanitizer=s,this.router=r,this.newMessages=c,this.messages=[],this.pendingMessages=[],this.messages_count=50,this.isLoading=!1,this.actualMessage={text:""},this.refreshMessagesTime=2e3,this.refreshChatTime=2e3,this.currentTime=0}ngOnChanges(n){this.ngOnDestroy(),this.isLoading=!0,this.getChat(),this.chatInterval=setInterval(()=>{this.getChat()},this.refreshChatTime),this.getChatMessages(),this.messagesInterval=setInterval(()=>{this.getChatMessages()},this.refreshMessagesTime),this.online?.subscribe(t=>{console.log("online",t),this.sendPendingMessages()})}ngOnInit(){this.online=(0,te.R)(window,"online"),this.newMessages.clearNewMessagesListener(),this.user=this.auth.getStorageUser()}sendPendingMessages(){for(let n of this.pendingMessages)this.apiService.addSubEntity("chats",this.selectedChat?.id,"messages",n).subscribe(t=>{console.log(t),this.pendingMessages.pop()},t=>{console.log(t)})}getChat(){this.apiService.getEntity("chats",this.chat_id).subscribe(n=>{this.selectedChat=n,this.isLoading=!1},n=>{console.log(n)})}getChatMessages(){this.messagesContainer=document.getElementById("messages-container-scroll");let n=this.messagesContainer?.scrollHeight;this.apiService.getSubEntity("chats",this.chat_id,"messages?per_page="+this.messages_count).subscribe(t=>{t.sort(function(o,a){return new Date(o.created_at).getTime()-new Date(a.created_at).getTime()}),this.messages.length<=0&&(this.scrollToBottom(),this.messages=t,this.setUnreadMessages()),this.messages.some(o=>o.id==t[t.length-1].id)||(this.messages=t,this.messagesContainer.scrollHeight-this.messagesContainer.scrollTop-this.messagesContainer?.clientHeight<250&&this.scrollToBottom()),this.messages.length<t.length&&(setTimeout(()=>{this.messagesContainer?.scroll({top:this.messagesContainer?.scrollHeight-n,left:0})}),this.messages=t,this.isLoading=!1),this.loading.stopLoading()},t=>{console.log(t),this.loading.stopLoading()})}sendMessage(){let n={text:this.actualMessage?.text,user:this.user,image:this.actualMessage?.image,created_at:new Date,pending:!0};this.deleteImage(),this.actualMessage.text="",this.messages?.push(n),this.selectedChat.unread_messages_count=0,console.log(this.selectedChat?.unread_messages_count),this.scrollToBottom(),this.apiService.addSubEntity("chats",this.selectedChat?.id,"messages",n).subscribe(t=>{console.log(t),this.messages[this.messages.length-1].pending=!1,new Audio("assets/audio/send_message.mp3").play(),this.actualMessage.text="",this.pendingMessages.pop()},t=>{console.log(t),this.pendingMessages.push(n)})}scrollToBottom(){setTimeout(()=>{this.messagesContainer?.scroll({top:this.messagesContainer.scrollHeight,left:0,behavior:"smooth"})})}readMessages(){setTimeout(()=>{this.messagesContainer?.scroll({top:this.messagesContainer?.scrollHeight,left:0,behavior:"smooth"})},250),this.messagesContainer?.scrollHeight-this.messagesContainer?.scrollTop-this.messagesContainer?.clientHeight<250&&this.apiService.deleteEntity("new-messages",this.selectedChat.id).subscribe(()=>{console.log("Mensajes vistos")},n=>{console.log("No se pudieron ver los mensajes")})}ngOnDestroy(){clearInterval(this.messagesInterval),this.messagesInterval=null,clearInterval(this.chatInterval),this.chatInterval=null,clearInterval(this.pendingMessagesInterval),this.pendingMessagesInterval=null,this.readMessages()}back(){this.router.navigateByUrl("/chats")}recordAudio(){var n=this;return A(function*(){console.log("Recording audio xd"),n.recordedAudio=void 0,n.recorder=yield n.chatAudio.startRecording(),n.recorder.start()})()}stopRecordingAudio(){var n=this;return A(function*(){console.log("stoping audio xd"),n.recordedAudio=yield n.recorder.stop();let o={text:"",audio:new Audio(n.recordedAudio.audioUrl),audio_url:n.recordedAudio.audioUrl,user:n.user,created_at:new Date};n.actualMessage.text="",n.selectedChat.unread_messages_count=0,n.scrollToBottom(),n.messages?.push(o)})()}togglePlay(n){n.is_playing_audio?n.audio.pause():n.audio.play(),console.log("DURACION",n.audio?.duration),n.audio.ontimeupdate=t=>{this.currentTime=n.audio.currentTime},n.audio.onplaying=()=>{n.is_playing_audio=!0},n.audio.onpause=()=>{n.is_playing_audio=!1},n.audio.addEventListener("ended",function(){n.audio.currentTime=0,this.currentTime=0,console.log("ended")}),n.audio.addEventListener("loadeddata",function(){console.log("Audio duration: "+this.duration)})}uploadImage(n){var t=n.dataTransfer?n.dataTransfer.files[0]:n.target.files[0],a=new FileReader;t.type.match(/image-*/)?(a.onload=this._handleReaderLoaded.bind(this),a.readAsDataURL(t)):alert("invalid format")}_handleReaderLoaded(n){this.actualMessage.image=n.target.result,console.log(this.actualMessage)}deleteImage(){this.actualMessage.image=void 0}loadMoreMessages(){0==document.getElementById("messages-container-scroll")?.scrollTop&&(console.log(this.messages?.length),console.log(this.messages_count),this.messages?.length==this.messages_count&&(this.messages_count+=50,this.isLoading=!0))}setUnreadMessages(){this.messages=this.messages.map(n=>(n.unread=!1,n));for(let n=0;n<this.selectedChat?.unread_messages?.length;n++){let t=this.messages.find(o=>o.id==this.selectedChat?.unread_messages[n]);t&&(t.unread=!0)}console.log(this.messages)}static#e=this.\u0275fac=function(t){return new(t||z)(e.Y36(x.s),e.Y36(B.b),e.Y36(U.$),e.Y36(O),e.Y36(J.H7),e.Y36(C.F0),e.Y36(S.O))};static#t=this.\u0275cmp=e.Xpm({type:z,selectors:[["app-interior-chat"]],inputs:{chat_id:"chat_id"},features:[e.TTD],decls:13,vars:8,consts:[[1,"chat-container"],[1,"chats-content","row"],[1,"interior-chat","col-lg-12","col-12"],[1,"chat-title-container","row"],[1,"chats-sidebar-menu",3,"click"],[1,"fa","fa-arrow-left"],["class","chat-title",4,"ngIf"],["class","chat-users",4,"ngIf"],["id","messages-container-scroll",1,"messages-container",3,"scroll"],["class","btn-scroll",3,"click",4,"ngIf"],["class","loader-container row",4,"ngIf"],[3,"messages","user","unread_messages"],["class","chat-footer",4,"ngIf"],[1,"chat-title"],[1,"chat-users"],[4,"ngFor","ngForOf"],[1,"avatar-content"],["class","user-avatar","alt","","onError","this.src='assets/imgs/avatar.png'",3,"src",4,"ngIf"],["class","user-online",4,"ngIf"],[4,"ngIf"],["alt","","onError","this.src='assets/imgs/avatar.png'",1,"user-avatar",3,"src"],[1,"user-online"],[1,"btn-scroll",3,"click"],[1,"fa-solid","fa-angles-down"],["class","new-messages",4,"ngIf"],[1,"new-messages"],[1,"loader-container","row"],[1,"col-12"],["src","assets/imgs/box-transparent.png","alt","",1,"loader"],[1,"chat-footer"],[1,"input-container"],["class","upload-image",4,"ngIf"],["type","text","placeholder","Escribe un mensaje",1,"message-input",3,"ngModel","keydown.enter","ngModelChange","focus"],[1,"upload-image-button"],["for","file-upload",1,"custom-file-upload"],[1,"fa","fa-camera"],["id","file-upload","type","file",3,"change"],["class","send-button","type","button",3,"mousedown","mouseup",4,"ngIf"],["class","send-button","type","submit",3,"click",4,"ngIf"],[1,"upload-image"],[1,"delete-image-button","fa","fa-close",3,"click"],["alt","",3,"src"],["type","button",1,"send-button",3,"mousedown","mouseup"],[1,"fa","fa-microphone"],["type","submit",1,"send-button",3,"click"],[1,"fa","fa-paper-plane"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("click",function(){return o.back()}),e._UZ(5,"i",5),e.qZA(),e.YNc(6,Te,4,10,"p",6),e.YNc(7,He,2,1,"div",7),e.qZA(),e.TgZ(8,"div",8),e.NdJ("scroll",function(){return o.loadMoreMessages()}),e.YNc(9,Ze,3,1,"button",9),e.YNc(10,Qe,3,0,"div",10),e._UZ(11,"app-message-item",11),e.qZA()()(),e.YNc(12,Be,10,4,"div",12),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngIf",o.selectedChat),e.xp6(1),e.Q6J("ngIf",o.selectedChat),e.xp6(2),e.Q6J("ngIf",(null==o.messagesContainer?null:o.messagesContainer.scrollHeight)-(null==o.messagesContainer?null:o.messagesContainer.scrollTop)-(null==o.messagesContainer?null:o.messagesContainer.clientHeight)>250),e.xp6(1),e.Q6J("ngIf",o.isLoading),e.xp6(1),e.Q6J("messages",o.messages)("user",o.user)("unread_messages",null==o.selectedChat?null:o.selectedChat.unread_messages),e.xp6(1),e.Q6J("ngIf",o.selectedChat))},dependencies:[p.sg,p.O5,T,d.Fj,d.JJ,d.On,p.OU,p.uU],styles:[".chat-container[_ngcontent-%COMP%]{width:100%;overflow-y:hidden;overflow-x:hidden}.chat-container[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{text-align:center;padding:10px;background:rgba(0,0,0,.2);margin-top:10px;font-weight:700}.chat-container[_ngcontent-%COMP%]   .no-chats[_ngcontent-%COMP%]{text-align:center}.chat-container[_ngcontent-%COMP%]   .no-chats[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;margin-top:30vh;padding:10px;font-weight:700;font-size:20px}.chat-container[_ngcontent-%COMP%]   .no-chats[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:25px;width:auto;border:none;color:#fff;padding:10px 20px;background:var(--color-primary)}.chat-container[_ngcontent-%COMP%]   .void-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:26px;margin-top:42vh;text-align:center;font-weight:700;transform:translateY(-50%)}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]{padding:10px;border-radius:10px;box-shadow:var(--item-box-shadow);background:var(--chat-message-right-background);color:#fff;position:relative;margin-top:15px;width:300px;display:flex}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .audio-duration[_ngcontent-%COMP%], .chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .audio-hour[_ngcontent-%COMP%]{color:#fff;position:absolute;bottom:10px;font-size:12px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .audio-duration[_ngcontent-%COMP%]{left:50%}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .audio-hour[_ngcontent-%COMP%]{right:10px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .user-audio-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;object-fit:cover;height:60px;width:60px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{-webkit-appearance:none;width:100%;height:7px;background:rgba(255,255,255,.6);border-radius:5px;background-size:70% 100%;background-repeat:no-repeat}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;height:10px;width:3px;border-radius:50%;background:white;cursor:ew-resize;box-shadow:0 0 2px #555;-webkit-transition:background .3s ease-in-out;transition:background .3s ease-in-out}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{-webkit-appearance:none;height:20px;width:20px;border-radius:50%;background:#ff4500;cursor:ew-resize;box-shadow:0 0 2px #555;-moz-transition:background .3s ease-in-out;transition:background .3s ease-in-out}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-ms-thumb{-webkit-appearance:none;height:20px;width:20px;border-radius:50%;background:#ff4500;cursor:ew-resize;box-shadow:0 0 2px #555;-ms-transition:background .3s ease-in-out;transition:background .3s ease-in-out}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb:hover{background:#ff0200}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-thumb:hover{background:#ff0200}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-ms-thumb:hover{background:#ff0200}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-webkit-slider-runnable-track{-webkit-appearance:none;box-shadow:none;border:none;background:transparent}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-moz-range-track{-webkit-appearance:none;box-shadow:none;border:none;background:transparent}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]::-ms-track{-webkit-appearance:none;box-shadow:none;border:none;background:transparent}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .time-range[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chat-audio[_ngcontent-%COMP%]   .play-button[_ngcontent-%COMP%]{text-align:center;font-size:25px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]{padding:0;position:relative}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chats-sidebar-menu[_ngcontent-%COMP%]{display:none;border:none;background:none;width:auto;position:absolute;top:25px;left:25px;font-size:20px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]{background:white;margin:0;height:110px;border-bottom:.5px solid #ccc;padding:20px;top:0;width:100%;z-index:9999}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]   .chat-users[_ngcontent-%COMP%]{margin-top:10px;text-align:center}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]   .chat-users[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]{position:relative;overflow:hidden;display:inline;margin:0 auto}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]   .chat-users[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]   .user-online[_ngcontent-%COMP%]{position:absolute;top:12px;right:0;background:var(--color-open-reservation);height:12px;width:12px;border:2px solid white;border-radius:50px;z-index:9}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]   .chat-users[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{cursor:pointer;width:32px;margin-right:2px;height:32px;border-radius:50%;box-shadow:var(--item-box-shadow);object-fit:cover}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]   .chat-image[_ngcontent-%COMP%]{border-radius:50%;height:50px;width:50px;object-fit:cover}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]   .chat-title[_ngcontent-%COMP%]{font-weight:700;font-size:22px;padding:0 50px;text-align:center;margin:0}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .chat-title-container[_ngcontent-%COMP%]   .chat-hour[_ngcontent-%COMP%]{font-weight:400;font-size:12px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .messages-container[_ngcontent-%COMP%]{padding:50px;overflow-y:scroll;overflow-x:hidden;width:100%;top:110px;height:calc(100vh - 270px)}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .messages-container[_ngcontent-%COMP%]   .btn-scroll[_ngcontent-%COMP%]{background:white;color:var(--color-primary);width:50px;height:50px;border-radius:50%;border:none;box-shadow:var(--item-box-shadow);padding:10px;position:fixed;bottom:80px;font-size:20px;right:16px;z-index:999}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .messages-container[_ngcontent-%COMP%]   .btn-scroll[_ngcontent-%COMP%]   .new-messages[_ngcontent-%COMP%]{color:#fff;background:var(--color-primary);padding:0 5px;font-size:12px;border-radius:25px;position:fixed;bottom:114px;box-shadow:var(--item-box-shadow);right:14px;z-index:9999}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .messages-container[_ngcontent-%COMP%]   .btn-scroll[_ngcontent-%COMP%]:hover{color:#fff;background:var(--color-primary)}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .messages-container[_ngcontent-%COMP%]   .loader-container[_ngcontent-%COMP%]{text-align:center;position:absolute;overflow:hidden;left:0;z-index:9;right:0;padding:5px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .messages-container[_ngcontent-%COMP%]   .loader-container[_ngcontent-%COMP%]   .loader[_ngcontent-%COMP%]{width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]   .messages-container[_ngcontent-%COMP%]   .no-messages-text[_ngcontent-%COMP%]{text-align:center;font-size:22px;margin-top:50px}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]{margin:0 auto;text-align:center;-webkit-transform:translateZ(0);bottom:0;padding-bottom:10px;padding-top:10px;width:100%;background:white;border-top:.5px solid #fafafa}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{position:relative}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .upload-image[_ngcontent-%COMP%]{padding:20px}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .upload-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;border-radius:10px;max-height:50vh;box-shadow:var(--item-box-shadow)}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .upload-image[_ngcontent-%COMP%]   .delete-image-button[_ngcontent-%COMP%]{background:var(--color-primary);color:#fff;border-radius:10px;padding:7px 10px;font-size:13px;position:absolute;right:10px;top:5px}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .upload-image-button[_ngcontent-%COMP%]{display:inline}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .upload-image-button[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .upload-image-button[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]{cursor:pointer;box-shadow:var(--item-box-shadow);background:white;color:var(--color-primary);border:none;border-radius:50%;height:50px;width:50px;padding:15px;margin-left:10px;transition:ease .2s}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%], .chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .audio-button[_ngcontent-%COMP%]{cursor:pointer;box-shadow:var(--item-box-shadow);background:white;border:none;border-radius:50%;height:50px;width:50px;padding:15px;margin-left:10px;transition:ease .2s}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .audio-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;color:var(--color-primary)}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]:hover, .chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .audio-button[_ngcontent-%COMP%]:hover{background:#f8e5d3}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]:active{background:var(--color-primary);transform:scale(1.2)}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]:active   i[_ngcontent-%COMP%]{color:#fff}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]{width:60%;box-shadow:var(--item-box-shadow);background:white;border:none;border-radius:25px;padding:15px;font-size:16px}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]:focus{outline:none}@media (max-width: 902px){.chats-sidebar-menu[_ngcontent-%COMP%]{display:block!important}.messages-container[_ngcontent-%COMP%]{height:calc(100vh - 180px)!important;padding:20px 20px 20px 40px!important}.messages-container[_ngcontent-%COMP%]   .avatar-content[_ngcontent-%COMP%]   .user-online[_ngcontent-%COMP%]{height:15px!important;width:15px!important;border:2px solid white!important}.messages-container[_ngcontent-%COMP%]   .user-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{box-shadow:var(--item-box-shadow);border-radius:50%;height:55px!important;width:55px!important;object-fit:cover}.messages-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{max-width:250px!important}.void-text[_ngcontent-%COMP%]{display:none!important}}"]})}function Xe(i,n){if(1&i&&(e.TgZ(0,"p",21)(1,"b"),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",null==t.last_message.user?null:t.last_message.user.name,""),e.xp6(1),e.hij(": ",t.last_message.text," ")}}function Je(i,n){1&i&&(e.TgZ(0,"p",21),e._uU(1,"Sin mensajes a\xfan"),e.qZA())}function Fe(i,n){if(1&i&&(e.TgZ(0,"span",22),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.unread_messages_count)}}function De(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",13),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(r.selectChat(s.id))}),e.TgZ(1,"div",14),e._UZ(2,"img",15),e.qZA(),e.TgZ(3,"div",16)(4,"p",17),e._uU(5),e.TgZ(6,"span",18),e._uU(7),e.ALo(8,"date"),e.qZA()(),e.TgZ(9,"p"),e._uU(10),e.ALo(11,"date"),e.ALo(12,"slice"),e.qZA(),e.YNc(13,Xe,4,2,"p",19),e.YNc(14,Je,2,0,"p",19),e.YNc(15,Fe,2,1,"span",20),e.qZA()()}if(2&i){const t=n.$implicit,o=e.oxw(2);e.Q6J("ngClass",o.selected_chat_id==t.id?"chats-item row selected":"chats-item row"),e.xp6(2),e.Q6J("src",t.image,e.LSH),e.xp6(3),e.hij("",t.name," "),e.xp6(2),e.Oqu(e.xi3(8,9,null==t.last_message?null:t.last_message.created_at,"HH:mm")),e.xp6(3),e.AsE("",e.xi3(11,12,null==t.open_reservation?null:t.open_reservation.date,"dd-M-yy")," - ",e.Dn7(12,15,null==t.open_reservation||null==t.open_reservation.game_reservation_hour?null:t.open_reservation.game_reservation_hour.hour,0,5),""),e.xp6(3),e.Q6J("ngIf",t.last_message),e.xp6(1),e.Q6J("ngIf",!t.last_message),e.xp6(1),e.Q6J("ngIf",t.unread_messages_count)}}function Ve(i,n){if(1&i&&(e.TgZ(0,"div")(1,"div",7)(2,"div",8),e._UZ(3,"input",9)(4,"i",10),e.qZA()(),e.TgZ(5,"div",11),e.YNc(6,De,16,19,"div",12),e.qZA()()),2&i){const t=e.oxw();e.Gre("chats-sidebar ",t.selected_chat_id?"selected":""," justify-content-center col-md-4 col-12 "),e.xp6(6),e.Q6J("ngForOf",t.chats)}}function Ne(i,n){1&i&&(e.TgZ(0,"div",23)(1,"p"),e._uU(2,"Selecciona un chat para ver sus mensajes"),e.qZA()())}function je(i,n){if(1&i&&(e.TgZ(0,"div",24),e._UZ(1,"app-interior-chat",25),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("chat_id",t.selected_chat_id)}}class R{constructor(n,t,o,a,s,r){this.apiService=n,this.loading=t,this.auth=o,this.newMessages=a,this.router=s,this.activatedRoute=r,this.refreshMessagesTime=2e3,this.selected_chat_id=+r.snapshot.paramMap.get("id")}ngOnInit(){this.newMessages.clearNewMessagesListener(),this.loading.startLoading(),this.getChats(),this.chatsInterval=setInterval(()=>{this.getChats()},this.refreshMessagesTime)}getChats(){this.apiService.getEntity("chats").subscribe(n=>{console.log(n),n.sort(function(o,a){return new Date(a.last_message?.created_at).getTime()-new Date(o.last_message?.created_at).getTime()}),this.chats=n,n.some(o=>o.unread_messages_count>0),this.loading.stopLoading()},n=>{console.log(n),this.loading.stopLoading()})}scrollToBottom(){let n=document.getElementById("messages-container-scroll");n.scrollTop=n.scrollHeight,console.log(n)}ngOnDestroy(){clearInterval(this.chatsInterval),this.chatsInterval=null,this.newMessages.setNewMessagesListener()}selectChat(n){console.log("chat seleccionado",n),this.router.navigate(["/chats/"+n]),this.selected_chat_id=n}static#e=this.\u0275fac=function(t){return new(t||R)(e.Y36(x.s),e.Y36(B.b),e.Y36(U.$),e.Y36(S.O),e.Y36(C.F0),e.Y36(C.gz))};static#t=this.\u0275cmp=e.Xpm({type:R,selectors:[["app-chats"]],decls:11,vars:6,consts:[[1,"chat-container"],[1,"no-chats",3,"hidden"],["routerLink","/search"],[1,"chats-content","row"],[3,"class",4,"ngIf"],["class","col-lg-8 col-12 void-text",4,"ngIf"],["class","col-md-8 col-12 interior-chat ",4,"ngIf"],[1,"chats-searchbar-container","row","justify-content-center"],[1,"col-12"],["type","searchbar","placeholder","Buscar chat",1,"chats-searchbar","col-12"],[1,"search-icon","fa","fa-search"],[1,"chats-items-container","col-12"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"col-lg-2","col-3","my-auto","text-center"],["alt","",1,"chat-image",3,"src"],[1,"col-lg-10","col-9","my-auto"],[1,"chat-name"],[1,"chat-hour"],["class","chat-last-message",4,"ngIf"],["class","new-messages-count",4,"ngIf"],[1,"chat-last-message"],[1,"new-messages-count"],[1,"col-lg-8","col-12","void-text"],[1,"col-md-8","col-12","interior-chat"],[3,"chat_id"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.ALo(2,"async"),e.TgZ(3,"p"),e._uU(4,"No tienes ning\xfan chat activo, realiza una reserva!"),e.qZA(),e.TgZ(5,"button",2),e._uU(6,"Reservar"),e.qZA()(),e.TgZ(7,"div",3),e.YNc(8,Ve,7,4,"div",4),e.YNc(9,Ne,3,0,"div",5),e.YNc(10,je,2,1,"div",6),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("hidden",(null==o.chats?null:o.chats.length)>0||e.lcZ(2,4,o.loading.isLoading)),e.xp6(7),e.Q6J("ngIf",(null==o.chats?null:o.chats.length)>0),e.xp6(1),e.Q6J("ngIf",(null==o.chats?null:o.chats.length)>0&&!o.selected_chat_id),e.xp6(1),e.Q6J("ngIf",o.selected_chat_id&&(null==o.chats?null:o.chats.length)>0))},dependencies:[p.mk,p.sg,p.O5,z,C.rH,p.Ov,p.OU,p.uU],styles:[".chat-container[_ngcontent-%COMP%]{width:100%;overflow-y:hidden;overflow-x:hidden}.chat-container[_ngcontent-%COMP%]   .interior-chat[_ngcontent-%COMP%]{padding:0!important}.chat-container[_ngcontent-%COMP%]   .no-chats[_ngcontent-%COMP%]{text-align:center}.chat-container[_ngcontent-%COMP%]   .no-chats[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;margin-top:30vh;padding:10px;font-weight:700;font-size:20px}.chat-container[_ngcontent-%COMP%]   .no-chats[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:25px;width:auto;border:none;color:#fff;padding:10px 20px;background:var(--color-primary)}.chat-container[_ngcontent-%COMP%]   .void-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:26px;margin-top:42vh;text-align:center;font-weight:700;transform:translateY(-50%)}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]{padding:0;border-right:.5px solid #ccc;background-color:var(--dark-background);background-image:url(box-transparent-dark.db412c6563d92b68.svg);background-size:150px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-searchbar-container[_ngcontent-%COMP%]{width:100%;background:var(--chat-message-left-background);padding:20px 20px 20px 40px;height:80px;position:relative;margin:0}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-searchbar-container[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{left:70px;top:34px;position:absolute;color:var(--color-primary)}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-searchbar[_ngcontent-%COMP%]{border:none;background:white;border-radius:25px;width:100%;padding:10px 10px 10px 40px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-searchbar[_ngcontent-%COMP%]:focus{outline:none;border:2px solid var(--color-primary)}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-sidebar-title[_ngcontent-%COMP%]{font-weight:700;font-size:22px;text-align:center;padding:20px;border-bottom:.5px solid #ccc;margin:0}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]{padding-left:20px;padding-bottom:20px;height:calc(100vh - 170px);overflow-y:scroll;color:#fff}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]{position:relative;padding:15px;border-bottom:.5px solid var(--chat-message-left-background);cursor:pointer}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]   .new-messages-count[_ngcontent-%COMP%]{position:absolute;bottom:30px;padding:0 5px;color:#fff;background:var(--color-primary);right:25px;font-weight:700;font-size:14px;border-radius:5px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]   .chat-last-message[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]   .chat-last-message[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{height:20px;width:20px;object-fit:cover;border-radius:50%}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]   .chat-image[_ngcontent-%COMP%]{border:2px solid white;box-shadow:var(--item-box-shadow);border-radius:50%;width:65px;height:65px;object-fit:cover}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]   .chat-hour[_ngcontent-%COMP%]{font-weight:400;float:right;font-size:14px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-weight:700;font-size:16px}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .chats-item[_ngcontent-%COMP%]:hover{background:var(--chat-message-left-background);scale:1.005}.chat-container[_ngcontent-%COMP%]   .chats-content[_ngcontent-%COMP%]   .chats-sidebar[_ngcontent-%COMP%]   .chats-items-container[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{background:var(--chat-message-left-background)}@media (max-width: 902px){.chats-items-container[_ngcontent-%COMP%]{height:calc(100vh - 90px)!important}.messages-container[_ngcontent-%COMP%]{height:70vh!important;padding:20px 20px 50px!important}.selected[_ngcontent-%COMP%], .void-text[_ngcontent-%COMP%]{display:none!important}}@media (max-width: 480px){.chats-items-container[_ngcontent-%COMP%]{padding:0 20px!important}.chats-items-container[_ngcontent-%COMP%]{height:calc(100vh - 142px)!important}.chat-container[_ngcontent-%COMP%]   .chat-footer[_ngcontent-%COMP%]{bottom:60px!important}}"]})}var F=l(11209),qe=l(18232);class k{static#e=this.\u0275fac=function(t){return new(t||k)};static#t=this.\u0275mod=e.oAB({type:k});static#n=this.\u0275inj=e.cJS({imports:[p.ez,d.u5,C.Bz]})}let tt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[p.ez]]}),i})();class E{static#e=this.\u0275fac=function(t){return new(t||E)};static#t=this.\u0275mod=e.oAB({type:E});static#n=this.\u0275inj=e.cJS({imports:[p.ez,k,F._,d.u5,qe.K,tt]})}const nt=[{path:"",component:R}];class H{static#e=this.\u0275fac=function(t){return new(t||H)};static#t=this.\u0275mod=e.oAB({type:H});static#n=this.\u0275inj=e.cJS({imports:[p.ez,F._,d.u5,E,C.Bz.forChild(nt)]})}}}]);